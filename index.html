
<script>
  (function(){
    // Dauer pro Bild: index 0 = dienstplan (35s), index 1 = belegungsplan (20s)
    const DURATIONS = [35000, 20000];
    const slides = [document.getElementById('slide0'), document.getElementById('slide1')];
    const status = document.getElementById('status');
    let idx = 0;
    let timerId = null;

    // Preload (inkl. optionaler @2x Varianten)
    slides.forEach(imgEl => {
      const src = imgEl.getAttribute('src');
      const src2 = src.replace(/\.png$/i, '@2x.png');
      const p = new Image(); p.src = src;
      const p2 = new Image(); p2.src = src2;
    });

    function show(i) {
      // Sichtbarkeit setzen (Crossfade per CSS)
      slides.forEach((el, j) => el.classList.toggle('visible', j === i));

      // Statusanzeige
      const label = i === 0 ? 'Dienstplan' : 'Belegungsplan';
      status.textContent = `Angezeigt: ${label} — ${DURATIONS[i] / 1000}s`;

      // Debuglog (natürliche Größe)
      console.log('Anzeige:', label, 'natural:', slides[i].naturalWidth, 'x', slides[i].naturalHeight);

      // Nächsten Wechsel planen
      clearTimeout(timerId);
      timerId = setTimeout(() => {
        idx = (i + 1) % slides.length;
        show(idx);
      }, DURATIONS[i]);
    }

    // Start mit Dienstplan (35s)
    show(0);

    // Optional: Leertaste pausiert/wiedereinschaltet den Wechsel (einfacher Toggle)
    let running = true;
    window.addEventListener('keydown', e => {
      if (e.code === 'Space') {
        e.preventDefault();
        running = !running;
        if (!running) {
          clearTimeout(timerId);
          status.textContent = status.textContent + ' — pausiert';
          console.log('Slideshow pausiert');
        } else {
          const current = slides.findIndex(s => s.classList.contains('visible'));
          idx = current >= 0 ? current : 0;
          show(idx);
          console.log('Slideshow fortgesetzt');
        }
      }
    });

    // === NEU: periodisches Nachladen der Bildquellen (Cache-Busting) ===
    // >>> Diesen Block NACH show(0) und der Space-Logik einfügen <<<
    const REFRESH_MS = 60000; // alle 60s neu holen (anpassbar)
    function refreshSources() {
      if (document.visibilityState !== 'visible') return; // Optional: nur bei sichtbarem Tab
      slides.forEach((img) => {
        // Basis-Dateiname ohne vorhandene Query übernehmen
        const base = img.getAttribute('src').replace(/\?.*$/, '');
        // @2x wird automatisch via srcset vom Browser gewählt; Cache-Busting an src reicht
        img.src = `${base}?ts=${Date.now()}`;
      });
      console.log('Slideshow-Bilder aktualisiert');
    }
    setInterval(refreshSources, REFRESH_MS);
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'visible') refreshSources();
    });
  })();
</script>
